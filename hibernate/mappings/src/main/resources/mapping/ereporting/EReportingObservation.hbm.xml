<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
    "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">
<hibernate-mapping>
    <class name="org.n52.sos.ds.hibernate.entities.ereporting.EReportingObservation" table="Result">
	<subselect>SELECT
		r.Id AS observationId,
		'NUMERIC_OBSERVATION' as discriminator,
		r.observationId AS seriesId,
		r.startTime AS phenomenonTimeStart,
		r.endTime AS phenomenonTimeEnd,
		r.resultTime AS resultTime,
		r.Id AS unitId,
		o.processId AS offeringId,
		r.verification AS verification,
		r.validity AS validation,
		r.uncertainty AS uncertaintyEstimation,
		r.value as numericvalue
		FROM
		AQD.dbo.Observation o inner join
		AQD.dbo.Result r
		on o.Id=r.observationId
		WHERE o.Id=r.observationId AND r.value IS NOT NULL</subselect>
        <id name="observationId" type="long">
            <!-- <column name="observationid" />
					r.verification AS verification,
		r.validity AS validation,
            <generator class="assigned">
            </generator> -->
        </id>
        <discriminator column="discriminator" type="string"/>
        <many-to-one name="series" class="org.n52.sos.ds.hibernate.entities.ereporting.EReportingSeries" fetch="select" lazy="no-proxy" foreign-key="observationSeriesFk">
           	<column index="obsSeriesIdx" name="seriesId" not-null="true" unique-key="seriesIdentity" />
        </many-to-one>
         <property name="phenomenonTimeStart" type="timestamp" insert="false" update="false">
            <column index="obsPhenTimeStartIdx" name="phenomenonTimeStart" length="29" not-null="true" unique-key="observationIdentity"/>
        </property>
        <property name="phenomenonTimeEnd" type="timestamp" insert="false" update="false">
            <column index="obsPhenTimeEndIdx" name="phenomenonTimeEnd" length="29" not-null="true" unique-key="observationIdentity"/>
        </property>
        <property name="resultTime" type="timestamp" insert="false" update="false">
            <column index="obsResultTimeIdx" name="resultTime" length="29" not-null="true" unique-key="observationIdentity"/>
        </property>
        <property name="identifier" type="string">
           <formula>''</formula>
        </property>
        <many-to-one name="codespace" class="org.n52.sos.ds.hibernate.entities.Codespace" fetch="select" lazy="no-proxy" foreign-key="obsCodespaceIdentifierFk">
            <formula>null</formula>
        </many-to-one>
        <property name="name" type="string">
            <formula>''</formula>
        </property>
        <many-to-one name="codespaceName" class="org.n52.sos.ds.hibernate.entities.Codespace" fetch="select" foreign-key="obsCodespaceNameFk">
           <formula>null</formula>
        </many-to-one>
        <property name="description" type="string">
            <formula>''</formula>
        </property>
        <property name="deleted" type="org.hibernate.type.TrueFalseType">
           <formula>'F'</formula>
        </property>
        <many-to-one name="unit" class="org.n52.sos.ds.hibernate.entities.Unit" fetch="select" lazy="no-proxy" foreign-key="observationUnitFk">
            <column name="unitId" not-null="false" />
            <!-- <formula>(SELECT DISTINCT s.unit_pkid FROM sensorweb2ways.observation o inner join sensorweb2ways.series s on o.series_pkid=s.pkid WHERE series_pkid = s.pkid)</formula> -->
        </many-to-one>
        <many-to-one name="offerings" class="org.n52.sos.ds.hibernate.entities.Offering" fetch="select" lazy="no-proxy" foreign-key="obshasoffobservationidx">
            <column name="offeringId" not-null="true" />
            <!-- <formula>(SELECT DISTINCT s.unit_pkid FROM sensorweb2ways.observation o inner join sensorweb2ways.series s on o.series_pkid=s.pkid WHERE series_pkid = s.pkid)</formula> -->
        </many-to-one>
		<property name="samplingGeometry" type="org.hibernate.spatial.GeometryType">
             <formula>null</formula>
        </property>
        <property name="validation" type="int">
			<column name="validation" not-null="true" default="-1"/>
        </property>
        <property name="verification" type="int">
			<column name="verification" not-null="true" default="3"/>
        </property>
        <property name="primaryObservation" type="string">
             <formula>'hour'</formula>
        </property>
        <property name="timeCoverageFlag" type="org.hibernate.type.TrueFalseType">
            <formula>null</formula>
        </property>
        <property name="dataCaptureFlag" type="org.hibernate.type.TrueFalseType">
            <formula>null</formula>
        </property>
        <property name="dataCapture" type="double">
            <formula>null</formula>
        </property>
        <property name="uncertaintyEstimation" type="double">
            <column name="uncertaintyEstimation" not-null="false" />
        </property>
		<subclass name="org.n52.sos.ds.hibernate.entities.ereporting.EReportingNumericObservation" extends="org.n52.sos.ds.hibernate.entities.ereporting.EReportingObservation" discriminator-value="NUMERIC_OBSERVATION">
			<property name="value" type="double" column="numericvalue" />
        </subclass>
    </class>
</hibernate-mapping>
