<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC "-//Hibernate/Hibernate Mapping DTD 3.0//EN"
    "http://www.hibernate.org/dtd/hibernate-mapping-3.0.dtd">
<hibernate-mapping>
    <class name="org.n52.sos.ds.hibernate.entities.ObservationConstellation">
        <subselect>(
           SELECT
               @observationconstellationid:=@observationconstellationid+1 AS observationconstellationid,
               observableProperty AS observableProperty,
               1 AS observationType,
               `procedure` AS `procedure`,
               offering  AS offering,
               'F' AS deleted,
               'F' AS hiddenChild
           FROM (
               SELECT DISTINCT
                   procedure_ids.procedureId as `procedure`,
                   observableProperty_ids.observablePropertyId as observableProperty,
                   offering_ids.offeringId AS offering
               FROM
                   (SELECT
                       table_name AS offering,
                       table_name AS `procedure`,
                       column_name AS observableProperty
                       FROM information_schema.columns
                       WHERE table_schema = 'sea' AND data_type = 'double'
                       ORDER BY table_name
                   ) AS combinations
                   JOIN
                        (SELECT
                            @procedureId:=@procedureId+1 AS procedureId,
                            table_name AS identifier
                        FROM (
                            SELECT table_name
                            FROM information_schema.tables
                            WHERE table_schema = 'sea'
                            ORDER BY table_name
                        ) AS t1, (SELECT @procedureId:=0) AS t2) AS procedure_ids
                    ON combinations.procedure = procedure_ids.identifier
                    JOIN
                        (SELECT
                           @observablePropertyId:=@observablePropertyId+1 AS observablePropertyId,
                           column_name AS identifier
                        FROM (
                           SELECT DISTINCT column_name
                           FROM information_schema.columns
                           WHERE table_schema = 'sea' AND data_type = 'double'
                           ORDER BY column_name
                        ) AS t1, (SELECT @observablePropertyId:=0) AS t2) AS observableProperty_ids
                   ON combinations.observableProperty = observableProperty_ids.identifier
                   JOIN
                        (SELECT
                           @offeringId:=@offeringId+1 AS offeringId,
                           table_name AS identifier
                        FROM (
                           SELECT table_name
                           FROM information_schema.tables
                           WHERE table_schema = 'sea'
                           ORDER BY table_name
                        ) AS t1, (SELECT @offeringId:=0) AS t2) AS offering_ids
                   ON combinations.offering = offering_ids.identifier
               ORDER BY `procedure`, observableProperty
           ) AS t1, (SELECT @observationconstellationid:=0) AS t2
        )</subselect>
        <id name="observationConstellationId" type="long" />
        <many-to-one name="observableProperty" class="org.n52.sos.ds.hibernate.entities.ObservableProperty" fetch="select" lazy="no-proxy"/>
        <many-to-one name="procedure" class="org.n52.sos.ds.hibernate.entities.Procedure" fetch="select" lazy="no-proxy"/>
        <many-to-one name="observationType" class="org.n52.sos.ds.hibernate.entities.ObservationType" fetch="select" lazy="no-proxy"/>
        <many-to-one name="offering" class="org.n52.sos.ds.hibernate.entities.Offering" fetch="select" lazy="no-proxy"/>
        <property name="deleted" type="org.hibernate.type.TrueFalseType" />
        <property name="hiddenChild" type="org.hibernate.type.TrueFalseType" />
    </class>
</hibernate-mapping>
